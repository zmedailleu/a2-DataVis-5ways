<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3</title>
    <link rel="stylesheet" href="d3.css">
</head>
<body>
<div id="container"></div>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script type="module">

        // Declare the chart dimensions and margins.
        const width = 540;
        const height = 400;
        const marginTop = 20;
        const marginRight = 20;
        const marginBottom = 30;
        const marginLeft = 40;
        const container = document.getElementById("container");

        const data = await d3.csv("/penglings.csv");

        const x = d3.scaleLinear()
            .domain([170, 235])
            .range([marginLeft, width - marginRight]);

        const y = d3.scaleLinear()
            .domain([2500, 6500])
            .range([height - marginBottom, marginTop]);

        //set point size based on bill length
        const minBillLength = d3.min(data.map(d => d.bill_length_mm));
        const maxBillLength = d3.max(data.map(d => d.bill_length_mm).filter(d => d != "NA"));
        const r = d3.scaleSqrt()
            .domain([minBillLength, maxBillLength])
            .range([4, 10])

        const colorScale = d3.scaleOrdinal(["orange", "purple", "teal"]).domain(["Adelie", "Chinstrap", "Gentoo"])

        const svg = d3.create("svg")
            .attr("width", width + 500)
            .attr("height", height + 500);

        var div = d3.select("body").append("div")
            .attr("class", "info")
            .style("opacity", 0)
            .style("position", "absolute")

        svg.append("text")
            .attr("x", width/2 - 10)
            .attr("y", height + 20)
            .text("Flipper Length (mm)")
            .style("font-family", "Arial");

        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 20)
            .attr("x", -height/2 - 30)
            .text("Body Mass (g)")
            .style("font-family", "Arial");

        svg.append("g")
            .attr("transform", `translate(30,${height - marginBottom})`)
            .call(d3.axisBottom(x).ticks(7));

        svg.append("g")
            .attr("transform", `translate(${marginLeft + 30},0)`)
            .call(d3.axisLeft(y).ticks(5));

        svg.append("g")
            .selectAll("circle")
            .data(data)
            .join("circle")
            .attr("transform", `translate(30,0)`)
            .attr("cx", d => x(d.flipper_length_mm))
            .attr("cy", d => y(d.body_mass_g))
            .attr("r", d => r(d.bill_length_mm))
            .attr("fill", d => colorScale(d.species))
            .attr("opacity", 0.8)

            .on('mouseover', function (event, d) {
                d3.select(this).transition()
                    .attr('opacity', '1')
                    .attr("r", d => r(d.bill_length_mm)*2)
                    .duration('1')
                div.transition()
                    .duration(1)
                    .style('opacity', '1')
                div.html("<b>Island:</b> " +  d.island + "<br><b>Sex:</b> " + d.sex + "<br><b>Flipper Length:</b>" + d.flipper_length_mm + " mm <br><b>Body Mass:</b> " + d.body_mass_g + " g")
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 15) + "px")
            })
            .on('mouseout', function (event, d) {
                d3.select(this).transition()
                    .attr('opacity', '.8')
                    .attr("r", d => r(d.bill_length_mm))
                    .duration('1')
                div.transition()
                    .duration('1')
                    .style("opacity", 0)
            });

        // Append the SVG element.
        container.append(svg.node());

    </script>
</body>
</html>